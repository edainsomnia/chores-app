<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Care - {{ user.username }}</title>
    <link rel="icon" type="image/png" href="{{ url_for('static',filename='icon.png') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static',filename='icon.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#bb86fc">

    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register("{{ url_for('static', filename='sw.js') }}")
                .then(() => console.log("Service Worker registriert"))
                .catch(err => console.log("Service Worker Fehler", err));
            }
    </script>
</head>
<body class="dark-mode">
    <header class="personal-header">
        <h1>Self-Care Routine ✨</h1>
        <nav>
            <a href="{{ url_for('index') }}">← Household</a> | 
            <span>My Points: <strong>{{ points }}</strong></span>
        </nav>
    </header>

    <main class="calendar-container-wrapper">
        <section class="filter-nav">
            <form method="GET" action="{{ url_for('personal_tasks') }}">
                <label for="filter">Show:</label>
                <select name="filter" id="filter" onchange="this.form.submit()">
                    <option value="all" {% if selected_filter == 'all' %}selected{% endif %}>All Tasks</option>
                    <option value="daily" {% if selected_filter == 'daily' %}selected{% endif %}>Daily</option>
                    <option value="weekly" {% if selected_filter == 'weekly' %}selected{% endif %}>Weekly</option>
                    <option value="longer" {% if selected_filter == 'longer' %}selected{% endif %}>2 Weeks +</option>
                    <option value="bonus" {% if selected_filter == 'bonus' %}selected{% endif %}>Bonus</option>
                </select>
            </form>
        </section>

        <section class="task-list">
            {% if not tasks %}
                <p class="empty-state">No tasks found for this filter. ✨</p>
            {% else %}
                {% for task in tasks %}
                <div class="task-card personal-card">
                    <div class="task-info">
                        <h3>{{ task.title }}</h3>
                        <p>{{ task.points_worth }} Pts | Interval: {{ task.interval_value }}d</p>
                    </div>
                    <a href="{{ url_for('complete_task', task_id=task.id, from_page='personal') }}" 
                       class="complete-btn personal-btn">Done</a>
                </div>
                {% endfor %}
            {% endif %}
        </section>

        <section class="mini-calendar">
         <div class="calendar-header">
             <h3>History for {{ month_names[view_month-1] }} {{ view_year }}</h3>
             <form method="GET" action="{{ url_for('personal_tasks') }}" class="month-filter">
                 <select name="month" onchange="this.form.submit()">
                     {% for m in range(1, 13) %}
                     <option value="{{ m }}" {% if m == view_month %}selected{% endif %}>{{ month_names[m-1] }}</option>
                      {% endfor %}
                 </select>
                 <input type="hidden" name="filter" value="{{ selected_filter }}">
              </form>
          </div>

         <div class="mini-grid">
              <div class="mini-weekday">M</div><div class="mini-weekday">T</div><div class="mini-weekday">W</div>
             <div class="mini-weekday">T</div><div class="mini-weekday">F</div><div class="mini-weekday">S</div>
             <div class="mini-weekday">S</div>

              {% for day in days %}
              <div class="mini-day {% if day.date in logs %}done{% endif %} {% if day.date == today %}today{% endif %} start-{{ day.weekday + 1 if loop.first else '' }}">
                 {{ day.date.day }}
             </div>
             {% endfor %}
         </div>
      </section>

    
    </main>
</body>
</html>